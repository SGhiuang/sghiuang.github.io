<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>实验一：伏安法测电阻</title>
    <style>
        :root {
            --primary-color: #3498db;
            --text-color: #2c3e50;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            margin: 0;
            padding: 15px;
            background-color: #f5f7f9;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
        }

        .home-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 500;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            cursor: pointer;
            z-index: 10;
        }

        h1 {
            margin-top: 50px;
            text-align: center;
            padding: 0 60px;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .method-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .input-group {
            margin: 10px 0;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        input {
            box-sizing: border-box;
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
        }

        button {
            width: 100%;
            padding: 16px;
            margin: 20px 0;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            cursor: pointer;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        td, th {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }

        .result-columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .method-title {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 5px;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="/" class="home-btn">返回主页</a>
        <h1>伏安法测电阻</h1>

        <div class="method-section">
            <!-- 内接法参数 -->
            <div class="card">
                <h3 class="method-title">内接法电表内阻</h3>
                <div class="input-group">
                    <input type="number" id="innerResistance" placeholder="电流表内阻 (Ω)" step="0.01" value="0">
                </div>
                <h3 class="method-title">内接法测量数据</h3>
                <div id="innerDataInputs">
                    <div class="input-group">
                        <input type="number" placeholder="电压1 (V)" class="inner-voltage" step="0.01">
                        <input type="number" placeholder="电流1 (mA)" class="inner-current" step="0.01">
                    </div>
                    <div class="input-group">
                        <input type="number" placeholder="电压2 (V)" class="inner-voltage" step="0.01">
                        <input type="number" placeholder="电流2 (mA)" class="inner-current" step="0.01">
                    </div>
                    <div class="input-group">
                        <input type="number" placeholder="电压3 (V)" class="inner-voltage" step="0.01">
                        <input type="number" placeholder="电流3 (mA)" class="inner-current" step="0.01">
                    </div>
                    <div class="input-group">
                        <input type="number" placeholder="电压4 (V)" class="inner-voltage" step="0.01">
                        <input type="number" placeholder="电流4 (mA)" class="inner-current" step="0.01">
                    </div>
                    <div class="input-group">
                        <input type="number" placeholder="电压5 (V)" class="inner-voltage" step="0.01">
                        <input type="number" placeholder="电流5 (mA)" class="inner-current" step="0.01">
                    </div>
                </div>
            </div>

            <!-- 外接法参数 -->
            <div class="card">
                <h3 class="method-title">外接法电表内阻</h3>
                <div class="input-group">
                    <input type="number" id="outerResistance" placeholder="电压表内阻 (Ω)" step="0.01" value="0">
                </div>
                <h3 class="method-title">外接法测量数据</h3>
                <div id="outerDataInputs">
                    <div class="input-group">
                        <input type="number" placeholder="电压1 (V)" class="outer-voltage" step="0.01">
                        <input type="number" placeholder="电流1 (mA)" class="outer-current" step="0.01">
                    </div>
                    <div class="input-group">
                        <input type="number" placeholder="电压2 (V)" class="outer-voltage" step="0.01">
                        <input type="number" placeholder="电流2 (mA)" class="outer-current" step="0.01">
                    </div>
                    <div class="input-group">
                        <input type="number" placeholder="电压3 (V)" class="outer-voltage" step="0.01">
                        <input type="number" placeholder="电流3 (mA)" class="outer-current" step="0.01">
                    </div>
                    <div class="input-group">
                        <input type="number" placeholder="电压4 (V)" class="outer-voltage" step="0.01">
                        <input type="number" placeholder="电流4 (mA)" class="outer-current" step="0.01">
                    </div>
                    <div class="input-group">
                        <input type="number" placeholder="电压5 (V)" class="outer-voltage" step="0.01">
                        <input type="number" placeholder="电流5 (mA)" class="outer-current" step="0.01">
                    </div>
                </div>
            </div>
        </div>

        <button onclick="calculateResistance()">开始计算</button>

        <div class="card" id="detailedResult" style="display: none;">
            <h2>详细数据</h2>
            <div class="result-columns">
                <div>
                    <h3 class="method-title">内接法数据</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>电压(V)</th>
                                <th>电流(mA)</th>
                                <th>电阻(Ω)</th>
                            </tr>
                        </thead>
                        <tbody id="innerDataTable"></tbody>
                    </table>
                </div>
                <div>
                    <h3 class="method-title">外接法数据</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>电压(V)</th>
                                <th>电流(mA)</th>
                                <th>电阻(Ω)</th>
                            </tr>
                        </thead>
                        <tbody id="outerDataTable"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="card" id="finalResult" style="display: none;">
            <h2>最终结果</h2>
            <div class="result-columns">
                <div>
                    <h3 class="method-title">内接法结果</h3>
                    <p>修正后电阻: <span id="innerCorrected"></span> Ω</p>
                    <p>A类不确定度: ±<span id="innerUncertainty"></span> Ω</p>
                    <p>表达式: R = (<span id="innerExpression"></span>) Ω</p>
                </div>
                <div>
                    <h3 class="method-title">外接法结果</h3>
                    <p>修正后电阻: <span id="outerCorrected"></span> Ω</p>
                    <p>A类不确定度: ±<span id="outerUncertainty"></span> Ω</p>
                    <p>表达式: R = (<span id="outerExpression"></span>) Ω</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        function calculateResistance() {
            // 收集内接法数据
            const innerVoltages = Array.from(document.getElementsByClassName('inner-voltage'))
                .map(i => parseFloat(i.value)).filter(v => !isNaN(v));
            const innerCurrents = Array.from(document.getElementsByClassName('inner-current'))
                .map(i => parseFloat(i.value)).filter(v => !isNaN(v));
            
            // 收集外接法数据
            const outerVoltages = Array.from(document.getElementsByClassName('outer-voltage'))
                .map(i => parseFloat(i.value)).filter(v => !isNaN(v));
            const outerCurrents = Array.from(document.getElementsByClassName('outer-current'))
                .map(i => parseFloat(i.value)).filter(v => !isNaN(v));

            // 获取仪表参数
            const R_inner = parseFloat(document.getElementById('innerResistance').value) || 0;
            const R_outer = parseFloat(document.getElementById('outerResistance').value) || 0;

            // 数据验证
            const validateData = (voltages, currents, method) => {
                if (voltages.length < 2 || currents.length < 2 || voltages.length !== currents.length) {
                    alert(`${method}需要至少2组有效数据`);
                    return false;
                }
                return true;
            };

            if (!validateData(innerVoltages, innerCurrents, '内接法')) return;
            if (!validateData(outerVoltages, outerCurrents, '外接法')) return;

            // 计算函数
            const calculateMethod = (voltages, currents, R_meter, isInner) => {
                const resistances = voltages.map((v, i) => v / (currents[i]/1000));
                const avg = resistances.reduce((a,b) => a + b, 0) / resistances.length;
                const stdDev = Math.sqrt(resistances.reduce((a,b) => a + Math.pow(b - avg, 2), 0) / (resistances.length - 1));
                const uA = stdDev / Math.sqrt(resistances.length);
                
                const corrected = isInner 
                    ? avg - R_meter 
                    : (avg * R_meter) / (R_meter - avg) || avg;

                return {
                    resistances,
                    avg,
                    stdDev,
                    uA,
                    corrected
                };
            };

            // 分别计算两种方法
            const innerResult = calculateMethod(innerVoltages, innerCurrents, R_inner, true);
            const outerResult = calculateMethod(outerVoltages, outerCurrents, R_outer, false);

            // 更新表格数据
            document.getElementById('innerDataTable').innerHTML = innerVoltages.map((v, i) => `
                <tr>
                    <td>${v.toFixed(2)}</td>
                    <td>${innerCurrents[i].toFixed(2)}</td>
                    <td>${innerResult.resistances[i].toFixed(1)}</td>
                </tr>
            `).join('');

            document.getElementById('outerDataTable').innerHTML = outerVoltages.map((v, i) => `
                <tr>
                    <td>${v.toFixed(2)}</td>
                    <td>${outerCurrents[i].toFixed(2)}</td>
                    <td>${outerResult.resistances[i].toFixed(1)}</td>
                </tr>
            `).join('');

            // 更新最终结果
            document.getElementById('innerCorrected').textContent = innerResult.corrected.toFixed(1);
            document.getElementById('innerUncertainty').textContent = innerResult.uA.toFixed(1);
            document.getElementById('innerExpression').textContent = 
                `${innerResult.corrected.toFixed(1)} ± ${innerResult.uA.toFixed(1)}`;

            document.getElementById('outerCorrected').textContent = outerResult.corrected.toFixed(1);
            document.getElementById('outerUncertainty').textContent = outerResult.uA.toFixed(1);
            document.getElementById('outerExpression').textContent = 
                `${outerResult.corrected.toFixed(1)} ± ${outerResult.uA.toFixed(1)}`;

            // 显示结果区域
            document.getElementById('detailedResult').style.display = 'block';
            document.getElementById('finalResult').style.display = 'block';
        }
    </script>
</body>
</html>